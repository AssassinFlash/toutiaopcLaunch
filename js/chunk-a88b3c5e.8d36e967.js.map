{"version":3,"sources":["webpack:///./src/views/publish/index.vue","webpack:///./src/components/Home/usePublish.js","webpack:///./src/views/publish/index.vue?72fd","webpack:///./src/api/article.js","webpack:///./src/views/publish/index.vue?c83a"],"names":["class","default","hoverable","loading","title","separator","to","$route","params","id","ref","model","articleParams","rules","formRules","label-col","labelCol","wrapper-col","wrapperCol","label","name","value","allow-clear","content","auto-size","showCount","cover","type","style","placeholder","channel_id","channels","option","key","onValidate","useFormRules","required","message","trigger","min","max","components","Suspense","setup","publishForm","$router","loadChannels","res","data","images","onPublish","draft","success","push","validate","then","catch","err","error","loadArticle","articleId","width","span","render","__scopeId","getArticles","requestNet","method","url","getArticleChannels","deleteArticle","addArticle","getArticle","updateArticle","updateCommentStatus","articleID","allowComment","article_id","allow_comment"],"mappings":"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","file":"js/chunk-a88b3c5e.8d36e967.js","sourcesContent":["<template>\n  <div class=\"publish-container\">\n    <Suspense>\n      <template #default>\n\n        <a-card hoverable\n                class=\"publish-title\"\n                :loading='loading'>\n          <template #title>\n            <a-breadcrumb separator=\">\">\n              <a-breadcrumb-item>\n                <router-link :to=\"{ path: '/' }\">首页</router-link>\n              </a-breadcrumb-item>\n              <a-breadcrumb-item> {{ $route.params.id? '修改文章' : '发布文章' }} </a-breadcrumb-item>\n            </a-breadcrumb>\n          </template>\n          <a-form ref=\"publishForm\"\n                  :model=\"articleParams\"\n                  :rules='formRules'\n                  :label-col=\"labelCol\"\n                  :wrapper-col=\"wrapperCol\">\n            <a-form-item label=\"标题\"\n                         name=\"title\">\n              <a-input v-model:value='articleParams.title'\n                       allow-clear />\n            </a-form-item>\n            <a-form-item label=\"内容\"\n                         name=\"content\">\n              <a-textarea v-model:value='articleParams.content'\n                          :auto-size=\"{ minRows: 4, maxRows: 8 }\"\n                          allow-clear\n                          showCount></a-textarea>\n            </a-form-item>\n            <a-form-item label=\"封面\">\n              <a-radio-group name='articleImage'\n                             v-model:value='articleParams.cover.type'>\n                <a-radio :value=\"1\">单图</a-radio>\n                <a-radio :value=\"3\">三图</a-radio>\n                <a-radio :value=\"0\">无图</a-radio>\n                <a-radio :value=\"-1\">自动</a-radio>\n              </a-radio-group>\n            </a-form-item>\n            <a-form-item label=\"频道\"\n                         name='channel_id'>\n              <a-select style=\"width:300px\"\n                        placeholder=\"请选择频道\"\n                        v-model:value='articleParams.channel_id'\n                        @change=\"articleParams.channel_id==='0'? articleParams.channel_id = null : articleParams.channel_id\">\n                <a-select-option value=\"0\">全部</a-select-option>\n                <a-select-option v-for=\"option in channels\"\n                                 :value=\"option.id\"\n                                 :key=\"option.id\">{{option.name}}</a-select-option>\n              </a-select>\n            </a-form-item>\n            <a-form-item :wrapper-col=\"{ span: 14, offset: 1 }\">\n              <a-button type=\"primary\"\n                        @click=\"onValidate()\">{{ $route.params.id? '修改' : '发表' }}</a-button>\n            </a-form-item>\n          </a-form>\n        </a-card>\n      </template>\n    </Suspense>\n  </div>\n</template>\n\n<script>\nimport { ref, Suspense, onBeforeMount } from 'vue'\nimport { useRoute, useRouter } from 'vue-router'\nimport { message } from 'ant-design-vue'\nimport { getArticleChannels, addArticle, getArticle, updateArticle } from '@/api/article'\nimport { useFormRules } from '@/components/Home/usePublish'\nexport default {\n  name: 'PublishIndex',\n  components: {\n    Suspense\n  },\n  setup () {\n    // 加载表单验证对象\n    const formRules = useFormRules()\n    // 获取表单元素\n    const publishForm = ref()\n\n    // 加载数据状态\n    const loading = ref(false)\n    // 获得修改按钮传来的数据\n    const $route = useRoute()\n    // 获得路由对象\n    const $router = useRouter()\n\n    // 加载文章频道\n    const channels = ref([])\n    const loadChannels = async function () {\n      const res = await getArticleChannels()\n      channels.value = res.data.data.channels\n    }\n\n    // 发布文章要求的数据\n    const articleParams = ref({\n      title: '', // 文章标题\n      content: '', // 文章内容\n      cover: { // 文章封面\n        type: 0, // 封面类型 -1:自动，0:无图，1:1张，3:3张\n        images: [] // 封面图片的地址\n      },\n      channel_id: null // 文章频道\n    })\n    // 发布文章的方法\n    const onPublish = async function (draft = false) {\n      // 如果是修改文章，则执行修改操作，否则执行添加操作\n      if ($route.params.id) {\n        await updateArticle($route.params.id, articleParams.value)\n        message.success(`修改文章：${articleParams.value.title} 成功`)\n      } else {\n        await addArticle(articleParams.value, draft)\n        message.success(`发布文章：${articleParams.value.title} 成功`, 3)\n      }\n      // 无论是修改文章还是发布文章，成功了之后都要跳转到内容管理页面\n      $router.push({ name: 'Article' })\n      loading.value = false\n    }\n\n    // 手动触发表单验证\n    const onValidate = function () {\n      publishForm.value.validate().then(() => {\n        onPublish(false)\n      }).catch(err => {\n        message.error(`表单验证失败${err}`, 3)\n      })\n    }\n\n    // 获得指定文章\n    const loadArticle = async function (articleId) {\n      loading.value = true\n      const res = await getArticle(articleId)\n      delete res.data.data.id\n      articleParams.value = res.data.data\n      loading.value = false\n    }\n\n    onBeforeMount(async () => {\n      await loadChannels()\n      // 由于发布和修改使用同一组件，\n      // 要判断路由传参ID，则请求展示文章内容\n      if ($route.params.id) {\n        await loadArticle($route.params.id)\n      }\n    })\n    return {\n      labelCol: {\n        style: {\n          width: '50px'\n        }\n      },\n      wrapperCol: {\n        span: '14'\n      },\n      formRules,\n      publishForm,\n      loading,\n      articleParams,\n      channels,\n      onValidate\n    }\n  }\n}\n</script>\n\n<style lang=\"less\" scoped>\n.publish-container {\n  padding: 10px;\n}\n</style>\n","export function useFormRules () {\n  // 表单验证规则\n  return {\n    title: [\n      {\n        required: true,\n        message: '请输入文章标题',\n        trigger: 'blur'\n      },\n      {\n        min: 3,\n        max: 30,\n        message: '文章标题字数至少为3',\n        trigger: 'change'\n      }\n    ],\n    content: [\n      {\n        required: true,\n        message: '请输入文章内容',\n        trigger: 'blur'\n      }\n    ],\n    channel_id: [\n      {\n        required: true,\n        message: '请选择文章频道'\n      }\n    ]\n  }\n}\n","import { render } from \"./index.vue?vue&type=template&id=1f31fad2&scoped=true\"\nimport script from \"./index.vue?vue&type=script&lang=js\"\nexport * from \"./index.vue?vue&type=script&lang=js\"\n\nimport \"./index.vue?vue&type=style&index=0&id=1f31fad2&lang=less&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-1f31fad2\"\n\nexport default script","/*\n* 文章相关请求模块 */\nimport { requestNet } from '@/utils/request'\n\n// 获取文章列表\nexport const getArticles = params => {\n  return requestNet({\n    method: 'GET',\n    url: '/mp/v1_0/articles',\n    // body参数用data传，query参数用params传\n    params: params\n  })\n}\n\n// 获取文章频道\nexport const getArticleChannels = () => {\n  return requestNet({\n    method: 'GET',\n    url: '/mp/v1_0/channels'\n  })\n}\n\n// 删除文章\n// 删除失败的原因：这是因为后端返回的ID是字符串\n// axios为了方便，把字符串转成JS对象，在JS对象中，大整数字符串会被转成整数\n// 如果大整数太大，那么转成整数就会出现超出界限导致出现误差\n// 这样子axios返回的ID就不是后端返回的那个原来的ID\n// 导致删除时ID传进去接口找不到对应文章，因此删除失败\n\n// 解决思路：axios会在内部使用JSON.parse把后端返回的数据转为js数据对象\n// 那就不要让axios使用JSON.parse转换数据，而是使用json-bigint来做转换处理\nexport const deleteArticle = articleId => {\n  return requestNet({\n    method: 'DELETE',\n    // 接口文档写的路径参数需要在url中传递\n    // :xxx 就是路径参数，把数据替换掉:xxx\n    url: `/mp/v1_0/articles/${articleId}`\n  })\n}\n\n// 新建文章\nexport const addArticle = (data, draft = false) => {\n  return requestNet({\n    method: 'POST',\n    url: '/mp/v1_0/articles',\n    params: {\n      draft\n    },\n    data\n  })\n}\n\n// 获取指定文章\nexport const getArticle = (articleId) => {\n  return requestNet({\n    method: 'GET',\n    url: `/mp/v1_0/articles/${articleId}`\n  })\n}\n\n// 编辑文章\nexport const updateArticle = (articleId, data, draft = false) => {\n  return requestNet({\n    method: 'PUT',\n    url: `/mp/v1_0/articles/${articleId}`,\n    params: {\n      draft\n    },\n    data\n  })\n}\n// 修改文章评论状态\nexport const updateCommentStatus = (articleID, allowComment) => {\n  return requestNet({\n    method: 'PUT',\n    url: '/mp/v1_0/comments/status',\n    params: {\n      article_id: articleID\n    },\n    data: {\n      allow_comment: allowComment\n    }\n  })\n}\n","export * from \"-!../../../node_modules/@vue/cli-service/node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/@vue/cli-service/node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./index.vue?vue&type=style&index=0&id=1f31fad2&lang=less&scoped=true\""],"sourceRoot":""}